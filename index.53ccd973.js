const e=document.querySelector(".game-field");var t={};function s(e){document.querySelector(".game-score").textContent=e}function i(t){let s=Array.from(e.querySelectorAll(".field-row"));t.forEach((e,t)=>{e.forEach((e,i)=>{let r=s[t].cells[i];r.textContent="",r.classList.forEach(e=>{e.startsWith("field-cell--")&&r.classList.remove(e)}),0!==e&&(r.textContent=e,r.classList.add(`field-cell--${e}`))})})}function r(e){let t=document.querySelector(".message-win"),s=document.querySelector(".message-lose"),i=document.querySelector(".message-start");switch(e){case"idle":i.classList.remove("hidden");break;case"lose":s.classList.remove("hidden");break;case"win":t.classList.remove("hidden")}}t=class{constructor(e=null){this.size=4,this.score=0,this.status="idle",this.field=e||Array.from({length:4},()=>[0,0,0,0])}getState(){return this.field}getScore(){return this.score}getStatus(){return this.status}moveLeft(){for(let e=0;e<4;e++){let t=this.field[e],s=this.mergeLeft(t);this.field[e]=s}}mergeLeft(e){let t=e.filter(e=>0!==e);for(let e=0;e<t.length-1;e++)t[e]===t[e+1]&&(t[e]=2*t[e],t[e+1]=0,this.score+=t[e],e++);for(t=t.filter(e=>0!==e);t.length<4;)t.push(0);return t}moveRight(){for(let e=0;e<4;e++){let t=[...this.field[e]];t.reverse();let s=this.mergeLeft(t);s.reverse(),this.field[e]=s}}moveUp(){for(let e=0;e<4;e++){let t=[];for(let s=0;s<4;s++)t.push(this.field[s][e]);let s=this.mergeLeft(t);for(let t=0;t<4;t++)this.field[t][e]=s[t]}}moveDown(){for(let e=0;e<4;e++){let t=[];for(let s=0;s<4;s++)t.push(this.field[s][e]);t.reverse();let s=this.mergeLeft(t);s.reverse();for(let t=0;t<4;t++)this.field[t][e]=s[t]}}start(){"idle"===this.status&&(this.status="playing",this.field=Array.from({length:4},()=>[0,0,0,0]),this.score=0,this.addRandomTile(),this.addRandomTile())}restart(){this.status="idle",this.field=Array.from({length:4},()=>[0,0,0,0]),this.score=0}addRandomTile(){let e=[];for(let t=0;t<this.field.length;t++)for(let s=0;s<this.field[t].length;s++)0===this.field[t][s]&&e.push([t,s]);if(0===e.length)return;let t=Math.floor(Math.random()*e.length),[s,i]=e[t];this.field[s][i]=.9>Math.random()?2:4}handleMove(e){let t=this.field.map(e=>[...e]);switch(e){case"left":this.moveLeft();break;case"right":this.moveRight();break;case"up":this.moveUp();break;case"down":this.moveDown()}let s=!1;for(let e=0;e<4;e++){for(let i=0;i<4;i++)if(this.field[e][i]!==t[e][i]){s=!0;break}if(s)break}return s&&this.addRandomTile(),this.checkWin(),s}checkWin(){let e=!0;for(let t=0;t<this.field.length;t++){for(let s=0;s<this.field[t].length;s++){let i=this.field[t][s];if(2048===i){this.status="win";return}if(0===this.field[t][s])return;if(s<this.field[t].length-1&&i===this.field[t][s+1]||t<this.field.length-1&&i===this.field[t+1][s]){e=!1;break}}if(!e)break}e&&(this.status="lose")}},document.addEventListener("DOMContentLoaded",()=>{let e=new t,l=document.querySelector(".start"),a=document.querySelector(".message-win"),d=document.querySelector(".message-lose"),o=document.querySelector(".message.message-start");l.addEventListener("click",()=>{switch(e.getStatus()){case"idle":l.classList.remove("start"),l.classList.add("restart"),l.textContent="Restart",o.classList.add("hidden"),a.classList.add("hidden"),d.classList.add("hidden"),e.start();break;case"playing":case"win":case"lose":l.classList.remove("restart"),l.classList.add("start"),l.textContent="Start",o.classList.remove("hidden"),a.classList.add("hidden"),d.classList.add("hidden"),e.restart()}i(e.getState()),s(e.getScore()),r(e.getStatus())}),document.addEventListener("keydown",t=>{if("playing"!==e.getStatus())return;let l=!1;switch(t.key){case"ArrowLeft":l=e.handleMove("left");break;case"ArrowRight":l=e.handleMove("right");break;case"ArrowUp":l=e.handleMove("up");break;case"ArrowDown":l=e.handleMove("down")}if(!l)return;let a=e.getStatus(),d=e.getState(),o=e.getScore();i(d),s(o),r(a)})});
//# sourceMappingURL=index.53ccd973.js.map
